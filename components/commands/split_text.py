# Auto generated by LangBot Plugin SDK.
# Please refer to https://docs.langbot.app/en/plugin/dev/tutor.html for more details.
from __future__ import annotations

import logging
import sys
from typing import AsyncGenerator

from anyio import Path

from langbot_plugin.api.definition.components.command.command import Command, Subcommand
from langbot_plugin.api.entities.builtin.command.context import (
    CommandReturn,
    ExecuteContext,
)


class SplitText(Command):
    async def initialize(self) -> None:
        await super().initialize()

        from pkg.state import get_state

        logger = logging.getLogger("split_typing_plugin")

        @self.subcommand(name="on", help="å¼€å¯åˆ†æ®µ", usage="!split_text on", aliases=[])
        async def sendon(
            self, ctx: ExecuteContext
        ) -> AsyncGenerator[CommandReturn, None]:
            chat_type = ctx.event.launcher_type  # type: ignore
            chat_id = (
                ctx.event.launcher_id if chat_type == "group" else ctx.event.sender_id  # type: ignore
            )

            get_state().enable(chat_id)
            logger.info(f"ğŸ§©SplitTyping {chat_id} å·²å¼€å¯åˆ†æ®µå‘é€ã€‚")
            yield CommandReturn(text=f"å·²å¼€å¯åˆ†æ®µå‘é€ã€‚")

        # å…³é—­åˆ†æ®µ
        @self.subcommand(
            name="off", help="å…³é—­åˆ†æ®µ", usage="!split_text off", aliases=[]
        )
        async def sendoff(
            self, ctx: ExecuteContext
        ) -> AsyncGenerator[CommandReturn, None]:
            chat_type = ctx.event.launcher_type  # type: ignore
            chat_id = (
                ctx.event.launcher_id if chat_type == "group" else ctx.event.sender_id  # type: ignore
            )

            get_state().disable(chat_id)
            logger.info(f"ğŸ§©SplitTyping {chat_id} å·²å…³é—­åˆ†æ®µå‘é€ã€‚")
            yield CommandReturn(text=f"å·²å…³é—­åˆ†æ®µå‘é€ã€‚")
